<!-- templates/concession_form.html -->
<div class="card mt-3 p-3 shadow-sm mx-auto" style="max-width: 600px;">
	<form method="post" enctype="multipart/form-data" action="{% url 'apply_concession' %}">
		{% csrf_token %}

		<div class="mb-3">
			<label for="id_s_name" class="form-label">Student Name</label>
			<input type="text" name="s_name" id="id_s_name" class="form-control" required>
		</div>

		<div class="mb-3">
			<label for="id_b_date" class="form-label fw-bold">Birth Date</label>
			<div class="input-group">
				<span class="input-group-text"><i class="bi bi-calendar-event"></i></span>
				<input type="date" name="b_date" id="id_b_date" class="form-control" placeholder="Select your birth date">
			</div>
		</div>

		<div class="mb-3">
			<label for="id_age" class="form-label">Age</label>
			<input type="number" name="age" id="id_age" class="form-control">
		</div>

		<div class="mb-3">
			<label for="id_gender" class="form-label">Gender</label>
			<select name="gender" id="id_gender" class="form-select">
				<option value="">Select</option>
				<option value="Male">Male</option>
				<option value="Female">Female</option>
				<option value="Other">Other</option>
			</select>
		</div>

		<div class="mb-3">
			<label for="id_department" class="form-label">Department</label>
			<input type="text" name="department" id="id_department" class="form-control">
		</div>

		<div class="mb-3">
			<label for="id_address" class="form-label">Address</label>
			<textarea name="address" id="id_address" class="form-control" rows="3"></textarea>
		</div>

		<div class="mb-3">
			<label for="id_adhar_no" class="form-label">Aadhar Number</label>
			<input type="text" name="adhar_no" id="id_adhar_no" class="form-control">
		</div>

		<div class="mb-3">
			<label for="id_phone_no" class="form-label">Phone Number</label>
			<input type="tel" 
				name="phone_no" 
				id="id_phone_no" 
				class="form-control" 
				placeholder="Enter 10-digit phone number"
				pattern="\d{10}" 
				maxlength="10" 
				required>
			<div class="form-text">Enter 10 digits only.</div>
		</div>

		<div class="mb-3">
			<label for="id_email_id" class="form-label">Email Address</label>
			<input type="email" 
				name="email_id" 
				id="id_email_id" 
				class="form-control" 
				placeholder="Enter a valid email address"
				required>
			<div class="form-text">Example: student@example.com</div>
			<!-- Error message container -->
			<div id="emailError" class="text-danger small mt-1" style="display:none;"></div>
		</div>

		<div class="mb-3">
			<label for="id_destination" class="form-label">Destination</label>
			<input type="text" name="destination" id="id_destination" class="form-control">
		</div>

		<div class="mb-3">
			<label for="id_duration" class="form-label">Pass Duration (in months)</label>
			<input type="number" name="duration" id="id_duration" class="form-control" min="1" max="3" placeholder="1 to 3 months" required>
		</div>

		<!-- File Uploads -->
		<div class="mb-3">
			<label for="id_adhar_card" class="form-label">Upload Aadhar Card</label>
			<input type="file" name="adhar_card" id="id_adhar_card" class="form-control" accept="image/*,.pdf" required>
		</div>

		<button type="submit" class="btn btn-primary w-100" {% if active_pass_exists %}disabled{% endif %}>Submit</button>
	</form>
</div>

<script>
	document.addEventListener("DOMContentLoaded", function () {
		const emailInput = document.getElementById("id_email_id");
		const emailError = document.getElementById("emailError");

		emailInput.addEventListener("blur", function (event) {
			const emailValue = emailInput.value.trim();
			const emailPattern = /^[^\s@]+@[^\s@]+\.[^\s@]+$/; // basic email regex

			if (emailValue && !emailPattern.test(emailValue)) {
				emailError.textContent = "? Please enter a valid email address.";
				emailError.style.display = "block";
				emailInput.classList.add("is-invalid");

				// Put cursor back inside the field
				emailInput.focus();
			} else {
				emailError.style.display = "none";
				emailInput.classList.remove("is-invalid");
			}
		});
	});
</script>